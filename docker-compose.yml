version: "3"
services:

  simulation:
    image: simulation
    volumes: 
        - ./simulation:/workspace
        - ./api_server/app:/app
    tty: true
    
    links:
      - postgres
     
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  postgres:
    image: postgres:12.1
    restart: always
    environment:
      POSTGRES_USER: root
    volumes:
      - ./init:/docker-entrypoint-initdb.d

  api_server:
    image: api_server
    volumes:
        - ./api_server/app:/app
  
    
    expose:
      - 8080
    
    links:
      - postgres
    command: python3 /app/api_server.py  
    tty: true
